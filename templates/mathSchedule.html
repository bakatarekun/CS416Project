{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
<head>

    <title>Second Website</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="myCss2.css">
    <script src="{% static 'myJs.js' %}"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function(){

            var day =  $('#dayinputhidden').val();
            $('#daylbl').text(day);
            if(day !='')
            {showScheduleByDay(day);}

            $('input[name="daybtn"]').on('click',function (){
                var day1=  $(this).val();
                day1 = "/schedule/" + day1;
                window.location.href= day1;

            });

        });

        function showScheduleByDay(dayofshift) {
            var URL="/allTutorsNames/";
            URL = URL+ dayofshift ;
            $.ajax({
                type: "GET",
                url: URL,
                dataType: "json",
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    makerows(data);

                },

                error: function () {

                    alert("wasn't succesful");

                }
            });


        }

        function makerows(tutors) {

            var setoftutors = tutors;
            var counter = 9;
            var rowcounter = 0;
            var content = "<div class='table-responsive'><table id='tbl' class='table table-bordered'><tbody name='tb'>"

            content += '<div><tr>'
            for (s = 8; s < 33; s++) {

                if (s > 8) {

                    if (s % 2 == 0) {
                        counter++;
                        if(counter==13){
                            counter=1;
                        }

                        content += '<th class="thformat">' + counter + ': 00' + '</th>'

                    } else {
                        content += '<th class="thformat">' + counter + ': 30' + '</th>'
                    }
                } else {
                    content += '<th class="thformat">' + '&nbsp' + '</th>'
                }

            }

            content += '</div></tr>';

            for (i = 0; i < setoftutors.length; i++) {
                content += '<tr name="rowtest">'
                for (s = 0; s < 25; s++) {

                    if (s == 0) {
                        content += '<td class="tdformat">' + setoftutors[i].fields.tutor[0] + '</td>'
                        rowcounter++
                    }
                    else
                    {
                        var name = setoftutors[i].fields.tutor[0];
                        if(setoftutors[i].fields.tutor[1] == 'EA')
                        {
                            content += '<td class="tdformat" name='+name + ' >' + '&nbsp' + '</td>'
                        }
                        else if (setoftutors[i].fields.tutor[1] == 'SA')
                        {
                            content += '<td class="tdformat"  name="sacell" >' + '&nbsp' + '</td>'
                        }
                        else
                        {
                            content += '<td class="tdformat"  name="workstudy" >' + '&nbsp' + '</td>'
                        }

                    }

                }
                content += '</tr>';
            }

            content += "<tbody>" + "</table></div>"
            $('#here_table').append(content);

            var hours;
            var listoftutors ='<ul>'
            listoftutors += '<div style="position: sticky;"><h3>Tutor\'s Hours and Availabilities</h3>'

            for (s = 0; s < setoftutors.length ; s++) {

                var name= setoftutors[s].fields.tutor[0];
                var timefrom1= setoftutors[s].fields.From1;
                var timeto1= setoftutors[s].fields.To1;
                var typeofemployee =  setoftutors[s].fields.tutor[1];
                hours = setoftutors[s].fields.tutor[2];

                if(typeofemployee == 'EA')
                {
                    togglecells("td[name="+name+"]","eacellcolor", name);
                }
                else if (typeofemployee == 'SA')
                {
                    togglecells( "td[name=sacell]","sacellcolor",name);
                }
                else if (typeofemployee == 'Work Study')
                {
                    togglecells( "td[name=workstudy]","wscellcolor",name);
                }
                name= name+" ";
                listoftutors += '<li><span name="spanname">'+ name + '</span><span name="spanhours" id='+ name + '></span> Hours Left--' + '<span>Avaialbe From:'+ timefrom1 + ' To:'+ timeto1 +'</span></li>'
            }

            listoftutors += '</div></ul><br>';
            $('#listoftutors').append(listoftutors);


            $('tr').mouseleave(function() {
                var name1;
                var usedhours;
                for (s = 0; s < setoftutors.length ; s++) {

                    name1 = setoftutors[s].fields.tutor[0];
                    var  nameid = "#"+name1;
                    var hours2 = setoftutors[s].fields.tutor[2];
                    var usedhoursfromDB = parseFloat(setoftutors[s].fields.tutor[3]);
                    usedhours =  ($("td:contains("+name1+")").length-1)*.5;
                    usedhours = usedhours+usedhoursfromDB;
                    hours2 = hours2 - usedhours;

                }
                  /*  if(hours2<=0)
                    {
                        $(nameid).css({"color":"red"});
                    }
                    else {
                         $(nameid).css({"color":"black"});
                    }*/
                $(nameid).text(hours2);


            });

        }

        function saveUsedHours(name,usedhours) {

            $.ajax({
                type: "GET",
                url: "/saveUsedHours",
                dataType: "text",
                data: {"name":name, "usedhours":usedhours},
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    alert("data saved");
                },

                error: function () {

                    alert("wasn't succesful");

                }
            });
        }

        function getUsedHoursAndName() {

            var hourslist=  $('[name="spanhours"]').text();
            var namelist = $('[name="spanname"]').text();

        }
    </script>


    <style type="text/css">
        table {
            border: 1px solid black;

        }
        th, td {
            border: 1px solid black;
            width:60px;
            text-align: center;
        }
        .eacellcolor {
            background: greenyellow;
        }
        .sacellcolor {
            background: deepskyblue;
        }
        .wscellcolor {
            background: yellow;
        }
        .tdformat{
            font-size: x-large;
            height: auto;
            width:auto;
        }
        .thformat{
            font-size: large;
            height: auto;

        }
    </style>
</head>

<!-- body of the site -->
<body id="top">
{% include "header.html" %}
<input type="hidden" id="dayinputhidden" value="{{ day }}" />
{% if user.is_authenticated %}
    <br>
    <div class="row">

        <div class="col-sm-5" id="listoftutors"></div>
        <div  class="col-sm-7" id="daybtns" align="right" >

            <input class="btn btn-primary" id="Mondaybtn" name="daybtn" type="button" value="Monday"/>
            <input class="btn btn-primary" id="Tuesdaybtn" name="daybtn" type="button" value="Tuesday"/>
            <input class="btn btn-primary" id="Wednesdaybtn"name="daybtn" type="button" value="Wednesday"/>
            <input class="btn btn-primary" id="Thursdaybtn" name="daybtn" type="button" value="Thursday"/>
            <input class="btn btn-primary" id="Fridaybtn" name="daybtn" type="button" value="Friday"/>
            <input class="btn btn-primary" id="Saturdaybtn" name="daybtn" type="button" value="Saturday"/>
            <input class="btn btn-primary" id="Sundaybtn" name="daybtn" type="button" value="Sunday"/>
        </div>

    </div>


    <div  style="text-align: center;">
        <h1>Math Tutor Schedule</h1>
        <h2 id="daylbl"></h2>
    </div>
    <br>

    <div align='center' id="here_table"></div>

{% else %}
    <br>
    <br>

    <h2 class="tr" style="text-align: center">You are now logged out</h2>
    <br>
    <div class="container" style="text-align: center">

        <a class="btn btn-primary" href="{% url 'login' %}" role="button">Login</a>
    </div>
{% endif %}

</body>
</html>
