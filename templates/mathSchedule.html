{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
<head>

    <title>Second Website</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="myCss2.css">
    <script src="{% static 'myJs.js' %}"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function(){

      /*
                $.ajax({
                type: "GET",
                //use URL path to pass a parameter "days" to backend
                url: "/allTutorsNames/",
                dataType: "json",
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    makerows(data);
                },

                error: function () {

                    alert("wasn't succesful");

                }
            });
            */


                 $('input[name="daybtn"]').on('click',function (){
                var day = $(this).val();

                showScheduleByDay(day);
               // alert(day);

            });

        });

        function showScheduleByDay(dayofshift) {
               var URL="/allTutorsNames/";
               URL = URL+ dayofshift ;
               $.ajax({
                type: "GET",
                //use URL path to pass a parameter "days" to backend
                url: URL,
                dataType: "json",
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    makerows(data);

                },

                error: function () {

                    alert("wasn't succesful");

                }
            });


        }

        function makerows(tutors) {

            var setoftutors = tutors;
            var counter = 9;
            var rowcounter = 0;
            var content = " <table><tbody name='tb'>"

            content += '<div><tr>'
            for (s = 8; s < 33; s++) {

                if (s > 8) {

                    if (s % 2 == 0) {
                        counter++;
                        if(counter==13){
                            counter=1;
                        }

                        content += '<th class="thformat">' + counter + ': 00' + '</th>'

                    } else {
                        content += '<th class="thformat">' + counter + ': 30' + '</th>'
                    }
                } else {
                    content += '<th class="thformat">' + '&nbsp' + '</th>'
                }

            }

            content += '</div></tr>';

            for (i = 0; i < setoftutors.length; i++) {
                content += '<tr name="rowtest">'
                for (s = 0; s < 25; s++) {

                    if (s == 0) {
                        content += '<td class="tdformat">' + setoftutors[i].fields.tutor[0] + '</td>'
                        rowcounter++
                    }
                    else
                    {
                        var name = setoftutors[i].fields.tutor[0];
                        if(setoftutors[i].fields.tutor[1] == 'EA')
                        {
                            content += '<td class="tdformat" name='+name + ' >' + '&nbsp' + '</td>'
                        }
                        else if (setoftutors[i].fields.tutor[1] == 'SA')
                        {
                            content += '<td class="tdformat"  name="sacell" >' + '&nbsp' + '</td>'
                        }
                        else
                        {
                            content += '<td class="tdformat"  name="workstudy" >' + '&nbsp' + '</td>'
                        }

                    }

                }
                content += '</tr>';
            }

            content += "<tbody>" + "</table>"
            $('#here_table').append(content);

            var hours;
            var listoftutors ='<ul>'
            listoftutors += '<div>'

            for (s = 0; s < setoftutors.length ; s++) {

                var name= setoftutors[s].fields.tutor[0];
                var timefrom1= setoftutors[s].fields.From1;
                var timeto1= setoftutors[s].fields.To1;
                var typeofemployee =  setoftutors[s].fields.tutor[1];
                hours = setoftutors[s].fields.tutor[2];

                if(typeofemployee == 'EA')
                {
                    togglecells("td[name="+name+"]","eacellcolor", name);
                }
                else if (typeofemployee == 'SA')
                {
                    togglecells( "td[name=sacell]","sacellcolor",name);
                }
                else if (typeofemployee == 'Work Study')
                {
                    togglecells( "td[name=workstudy]","wscellcolor",name);
                }

                listoftutors += '<li>' + name + ' <span id='+ name + '></span> Hours Left--' + '<span>Avaialbe From:'+ timefrom1 + ' To:'+ timeto1 +'</span></li>'
            }

            listoftutors += '</div></ul><br>';
             //$('#listoftutors').remove();
            $('#listoftutors').append(listoftutors);

            {#var usedhours=0.0;#}
            {#var hours2=0.0;#}
            $('tr').mouseout(function() {

                for (s = 0; s < setoftutors.length ; s++) {

                    var name1= setoftutors[s].fields.tutor[0];
                    var nameid = "#"+name1;
                    var hours2 = setoftutors[s].fields.tutor[2];
                    var usedhoursfromDB = parseFloat(setoftutors[s].fields.tutor[3]);
                    var usedhours =  ($("td:contains("+name1+")").length-1)*.5;

                    usedhours = usedhours+usedhoursfromDB;
                    hours2 = hours2 - usedhours;
                    $(nameid).text(hours2);
                    console.log("used hours from DB " + usedhoursfromDB + 'usedhours ' + usedhours);

                }

            });

            {#saveUsedHours(name1,usedhours);#}
        }

        function saveUsedHours(name,usedhours) {

            $.ajax({
                type: "POST",
                url: "/saveUsedHours/",
                dataType: "json",
                data: {"name":name, "usedhours":usedhours},
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    alert("data saved");
                },

                error: function () {

                    alert("wasn't succesful");

                }
            });
        }
    </script>


    <style type="text/css">
        table {
            border: 1px solid black;

        }
        th, td {
            border: 1px solid black;
            width:60px;
            text-align: center;
        }
        .eacellcolor {
            background: greenyellow;
        }
        .sacellcolor {
            background: deepskyblue;
        }
        .wscellcolor {
            background: yellow;
        }
        .tdformat{
            font-size: x-large;
            height: auto;
            width:auto;
        }
        .thformat{
            font-size: large;
            height: auto;

        }
    </style>
</head>

<!-- body of the site -->
<body id="top">
{% include "header.html" %}

{% if user.is_authenticated %}
    <br>
<div align="center">
    <input id="Mondaybtn" name="daybtn" type="button" value="Monday"/>
    <input id="Tuesdaybtn" name="daybtn" type="button" value="Tuesday"/>
    <input id="Wednesdaybtn"name="daybtn" type="button" value="Wednesday"/>
    <input id="Thursdaybtn" name="daybtn" type="button" value="Thursday"/>
    <input id="Fridaybtn" name="daybtn" type="button" value="Friday"/>
    <input id="Saturdaybtn" name="daybtn" type="button" value="Saturday"/>
    <input id="Sundaybtn" name="daybtn" type="button" value="Sunday"/>
</div>
     <br>
    <div  style="text-align: center;">
        <div style="font-size: large" align='left' id="listoftutors"></div>
        <h1>Math Tutor Schedule</h1>
        <h3>Monday</h3>
    </div>
    <br>

    <div align='center' id="here_table"></div>

{% else %}
    <br>
    <br>

    <h2 class="tr" style="text-align: center">You are now logged out</h2>
    <br>
    <div class="container" style="text-align: center">

        <a class="btn btn-primary" href="{% url 'login' %}" role="button">Login</a>
    </div>
{% endif %}


{#{% for s in usedhours %}#}
{#    <li> {{s.tutor.firstname}}  {{s.usedhours}} </li>#}
{##}
{#{% endfor %}#}

</body>
</html>
